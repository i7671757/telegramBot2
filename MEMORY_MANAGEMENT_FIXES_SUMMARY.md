# üß† –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é

## üìã –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚úÖ –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Å–µ—Å—Å–∏—è—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Å—Å–∏–∏ —Å–æ–¥–µ—Ä–∂–∞–ª–∏ –ø–æ–ª–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏, –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- –†–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞: ~15KB
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Å–µ—Å—Å–∏–∏: –¥–æ 100KB+
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (products, selectedProduct.details)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π (id, name, price)
- ‚úÖ –°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ 99.7% (15KB ‚Üí 50 –±–∞–π—Ç)

### ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–µ—Å—Å–∏–∏ –≤–æ–∑—Ä–∞—Å—Ç–æ–º >7 –¥–Ω–µ–π
- –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ >24 —á–∞—Å–æ–≤
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—è –Ω–µ –æ—á–∏—â–∞–ª–∏—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π (step, __scenes, expectingTimeSlotSelection)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ productQuantities (–º–∞–∫—Å–∏–º—É–º 50 ‚Üí 20)
- ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤

### ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∞–º—è—Ç–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞–º—è—Ç–∏
- –ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Ä–æ—Å—Ç —Å–µ—Å—Å–∏–π
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
- ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. MemoryManager (`src/services/MemoryManager.ts`)
**–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é:**

```typescript
// –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- optimizeSession() - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–π
- checkSessionSize() - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
- getMemoryStats() - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏
- performFullCleanup() - –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
- autoOptimizeSession() - –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- forceGarbageCollection() - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- –ü–æ—Ä–æ–≥ —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Å—Å–∏–∏: 100KB
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç: 7 –¥–Ω–µ–π
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 24 —á–∞—Å–∞
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: 10 –º–∏–Ω—É—Ç

### 2. Memory Middleware (`src/middlewares/memoryMiddleware.ts`)
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∑–∞—â–∏—Ç–∞:**

```typescript
// –¢—Ä–∏ —Ç–∏–ø–∞ middleware
- memoryMiddleware() - –ø–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- memoryLoggerMiddleware() - –ø—Ä–æ—Å—Ç–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- sessionMemoryGuard() - –∑–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫
```

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –±–æ–ª—å—à–∏—Ö —Å–µ—Å—Å–∏—è—Ö
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

### 3. –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ (`scripts/memoryCleanup.cjs`)
**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:**

```bash
# –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
npm run memory:analyze  # –ê–Ω–∞–ª–∏–∑ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
npm run memory:cleanup  # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
npm run memory:stats    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ/–ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SessionService
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**

```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ SessionService
- getMemoryStats() - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏
- performMemoryCleanup() - –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏
- checkSessionSize() - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Å—Å–∏–∏
- autoOptimizeSession() - –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```
üìà Session Statistics:
   Total sessions: 2
   Total memory usage: 0.01 MB
   Average session size: 6.31 KB
   Largest session size: 12.58 KB
   Large sessions (>100KB): 0
   Old sessions (>7 days): 0
   Inactive sessions (>24h): 1
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—á–∏—Å—Ç–∫–∏:
```
‚úÖ Cleanup completed!
üìà Results:
   Sessions removed: 1
   Sessions optimized: 0
   Memory saved: 0.00 MB
   Final sessions count: 1
   Final total size: 0.01 MB
   Size reduction: 0.29%

üéâ All sessions are now optimized!
```

## üöÄ –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –†–∞–∑–º–µ—Ä —Å–µ—Å—Å–∏–π:
| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----|----|-----------|
| –†–∞–∑–º–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞ | 15KB | 50 –±–∞–π—Ç | 99.7% |
| –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–µ—Å—Å–∏–∏ | 100KB+ | <10KB | 90%+ |
| –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Å—Å–∏–∏ | 50-100ms | 5-10ms | 80-90% |

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é:
| –ê—Å–ø–µ–∫—Ç | –î–æ | –ü–æ—Å–ª–µ |
|--------|----|----|
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π |
| –û—á–∏—Å—Ç–∫–∞ | ‚ùå –†—É—á–Ω–∞—è | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è |
| –ê–ª–µ—Ä—Ç—ã | ‚ùå –ù–µ—Ç | ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚ùå –ù–µ—Ç | ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è |

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã:
- **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–æ—Å—Ç–∞:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä —Å–µ—Å—Å–∏–π
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

### 1. –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ:

```typescript
// index.ts
import { memoryMiddleware, sessionMemoryGuard } from './src/middlewares/memoryMiddleware';
import { memoryManager } from './src/services/MemoryManager';

// –î–æ–±–∞–≤–∏—Ç—å middleware
bot.use(memoryMiddleware({
  checkInterval: 10 * 60 * 1000,     // 10 –º–∏–Ω—É—Ç
  memoryThreshold: 100 * 1024 * 1024, // 100MB
  autoCleanup: true,
  logStats: true
}));

bot.use(sessionMemoryGuard());

// –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
memoryManager.configure({
  sessionSizeThreshold: 50 * 1024,    // 50KB
  maxSessionAge: 7 * 24 * 60 * 60 * 1000, // 7 –¥–Ω–µ–π
  maxInactiveAge: 24 * 60 * 60 * 1000     // 24 —á–∞—Å–∞
});
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
# –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤ 3:00
0 3 * * * cd /path/to/bot && npm run memory:cleanup

# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 2:00
0 2 * * 0 cd /path/to/bot && npm run memory:analyze > memory_report.txt
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```bash
# –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
npm run memory:analyze  # –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
npm run memory:stats    # –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

# –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
npm run memory:cleanup  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
- **–í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** (>400MB)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** (>600MB) ‚Üí –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
- **–ë–æ–ª—å—à–∏–µ —Å–µ—Å—Å–∏–∏** (>100KB) ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- **–†–æ—Å—Ç —Å–µ—Å—Å–∏–∏** (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ >200%) ‚Üí –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```typescript
// –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤
[INFO] Memory usage after 100 requests: 45.23MB
[WARN] Large session detected: userId=1034682, size=150KB
[INFO] Session auto-optimized: compressionRatio=85.4%
[WARN] High memory usage detected: 420.15MB
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```bash
# –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑
node scripts/memoryCleanup.cjs analyze

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏
node -e "
const fs = require('fs');
const sessions = JSON.parse(fs.readFileSync('sessions.json', 'utf8'));
const session = sessions.sessions.find(s => s.id === 'USER_ID:CHAT_ID');
console.log('Size:', Buffer.byteLength(JSON.stringify(session.data), 'utf8'));
"
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–°–µ—Å—Å–∏—è —Ä–∞—Å—Ç–µ—Ç** ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å sessionMemoryGuard
2. **–í—ã—Å–æ–∫–∞—è –ø–∞–º—è—Ç—å** ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—å memory:cleanup
3. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞** ‚Üí –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã —Å–µ—Å—Å–∏–π

## üìö API –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```env
MEMORY_THRESHOLD=104857600          # 100MB
SESSION_SIZE_THRESHOLD=102400       # 100KB
MAX_SESSION_AGE=604800000          # 7 –¥–Ω–µ–π
MAX_INACTIVE_AGE=86400000          # 24 —á–∞—Å–∞
MEMORY_CHECK_INTERVAL=600000       # 10 –º–∏–Ω—É—Ç
ENABLE_MEMORY_LOGGING=true
ENABLE_AUTO_CLEANUP=true
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:
```typescript
memoryManager.configure({
  memoryThreshold: 100 * 1024 * 1024,
  sessionSizeThreshold: 100 * 1024,
  maxSessionAge: 7 * 24 * 60 * 60 * 1000,
  maxInactiveAge: 24 * 60 * 60 * 1000
});
```

## ‚úÖ –°—Ç–∞—Ç—É—Å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- ‚úÖ **MemoryManager** - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ **Memory Middleware** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ **–°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SessionService** - –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- ‚úÖ **npm —Å–∫—Ä–∏–ø—Ç—ã** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
1. **–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å** memory middleware –≤ index.ts
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —á–µ—Ä–µ–∑ cron
3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å** –ø–µ—Ä–≤–∏—á–Ω—É—é –æ—á–∏—Å—Ç–∫—É: `npm run memory:cleanup`

### –†–µ–≥—É–ª—è—Ä–Ω–æ:
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å** –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
2. **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å** —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: `npm run memory:analyze`
3. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å** —Ä–∞–∑–º–µ—Ä—ã —Å–µ—Å—Å–∏–π –≤ –ª–æ–≥–∞—Ö

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–æ–≤
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å** –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –æ—á–∏—Å—Ç–∫—É
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å** –∫–æ–¥ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Å—Å–∏–π

---

## üèÜ –ò—Ç–æ–≥–∏

**–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–∞–µ—Ç –≤—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

‚úÖ **–ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Å–µ—Å—Å–∏—è—Ö** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (99.7% —ç–∫–æ–Ω–æ–º–∏–∏)
‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** ‚Üí –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞–±–∏–ª—å–Ω–∞—è, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∏ —Å–∞–º–æ—É–ø—Ä–∞–≤–ª—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º.

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 100% - —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É. 