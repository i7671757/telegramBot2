# üéØ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Telegram –±–æ—Ç–æ–º –∏ ngrok

## üìã –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã:

### 1. ‚ùå –û—à–∏–±–∫–∞ "Bot is not running!" –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ `bot.stop()` –∏–∑-–∑–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ SIGINT –∏ SIGTERM

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `isShuttingDown` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤:
```typescript
let isShuttingDown = false;

const gracefulShutdown = (signal: string) => {
  if (isShuttingDown) {
    console.log(`${signal} received, but shutdown already in progress`);
    return;
  }
  
  isShuttingDown = true;
  console.log(`${signal} received, stopping bot`);
  
  try {
    bot.stop(signal);
  } catch (error) {
    console.error('Error during bot shutdown:', error);
  }
};
```

### 2. ‚ùå –û—à–∏–±–∫–∞ ngrok "limited to 1 simultaneous session"
**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ ngrok –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:** 
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è `npm run start:ngrok`
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `npm run test:ngrok` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ ngrok

### 3. ‚ùå HTTP –≤–º–µ—Å—Ç–æ HTTPS –¥–ª—è webhook
**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è webhook

**–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ HTTPS —Ç—É–Ω–Ω–µ–ª—è —á–µ—Ä–µ–∑ ngrok

### 4. ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏ webhook
**–ü—Ä–æ–±–ª–µ–º–∞:** URL —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª—Å—è –∫–∞–∫ `/telegraf/telegraf`

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—É—Ç—å –≤ .env: `WEBHOOK_PATH=/webhook`

## üöÄ –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è .env:
```env
BOT_TOKEN=8141347686:AAHQ0_UOGFkUHUnMFk23WGDrONaBO8fsuZc
WEBHOOK_URL=https://dcff-146-120-16-63.ngrok-free.app  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
WEBHOOK_PATH=/webhook                                   # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—É—Ç—å
PORT=3000
HOST=0.0.0.0
NGROK_AUTHTOKEN=2uzB335dojXXGo6XI1NANpogRzi_2CopEC6QwC5yjvuwgEk9J
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º ngrok (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
bun run start:ngrok

# –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π WEBHOOK_URL)
bun run start

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
bun run dev
```

#### –£—Ç–∏–ª–∏—Ç—ã ngrok:
```bash
# –¢–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ngrok URL –±–µ–∑ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
bun run ngrok:update

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ ngrok
bun run test:ngrok
```

#### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
```bash
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å webhook
bun run webhook:fix

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
bun run test:config

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook
bun run webhook:info
```

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ WEBHOOK_URL** - –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π ngrok —Ç—É–Ω–Ω–µ–ª—å
2. **HTTPS webhook** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å
3. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–æ—Ç–∞** - –±–µ–∑ –æ—à–∏–±–æ–∫ "Bot is not running!"
4. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ngrok –∏ –±–æ—Ç–∞** - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
5. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
bun run start:ngrok
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π HTTPS URL –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
bun run start
```

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. `bun run webhook:fix` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
2. `bun run test:config` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏  
3. `bun run test:ngrok` - —Ç–µ—Å—Ç ngrok
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: `ps aux | grep -E "(bun|ngrok)"`

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

- `scripts/ngrok-webhook-updater.cjs` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ webhook
- `scripts/start-with-ngrok.cjs` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ ngrok + –±–æ—Ç
- `scripts/fix-webhook-url.cjs` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- `scripts/test-config.cjs` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `scripts/test-ngrok-only.cjs` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ ngrok
- `NGROK_SETUP.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:

–¢–µ–ø–µ—Ä—å –≤–∞—à Telegram –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º webhook URL –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ ngrok! –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã. 